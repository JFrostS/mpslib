<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>MPS by ergosimulation</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>MPS</h1>
        <h2>A C++ class for Mutiple Point Simulation algorithms</h2>

        <section id="downloads">
          <a href="https://github.com/ergosimulation/mps/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/ergosimulation/mps/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/ergosimulation/mps" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="mps-a-c-class-for-multiple-point-based-sequential-simulation" class="anchor" href="#mps-a-c-class-for-multiple-point-based-sequential-simulation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MPS: a C++ class for Multiple-Point based sequential Simulation</h1>

<p>MPS provides a set of algorithms for simulation of models based on a multiple point
statistical model inferred from a training image.</p>

<p>The goal of developing these codes has been to produce a set of algorithms, based
on sequential simulation, for simulation of multiple point statistical random models, 
The code should be easy to compile and extend, and should be allowed for both
commercial and non-commercial use.</p>

<p>MPS (version 1.0) has been developed by
<a href="http://www.i-gis.dk/">I-GIS</a>
and
<a href="http://imgp.nbi.ku.dk/">Solid Earth Physics, Niels Bohr Institute</a>.</p>

<p>Development has been funded by the Danish National Hightech Foundation (now: the Innovation fund) thorugh the ERGO (Effective high-resolution Geological Modeling) project, a collaboration between
<a href="http://i-gis.dk/">IGIS</a>,
<a href="http://geus.dk/">GEUS</a>, and 
<a href="http://nbi.ku.dk/">Niels Bohr Institute</a>.</p>

<h1>
<a id="documentation" class="anchor" href="#documentation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Documentation</h1>

<p>MPS is documented through Doxygen.</p>

<h1>
<a id="compilation" class="anchor" href="#compilation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Compilation</h1>

<p>The MPS codes are written in standard <a href="https://www.wikiwand.com/en/C%2B%2B11">C++11</a>.</p>

<p>MPS has been developed using the GNU C++ compiler (tested on Windows, Linux and OSX), and Visual Studio C++.</p>

<h2>
<a id="linux-gcc-version-483" class="anchor" href="#linux-gcc-version-483" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Linux (GCC version 4.8.3)</h2>

<p>On Ubuntu Linux 14.04, the following compiler flags are used:</p>

<p>CPPFLAGS = -g -static -O3 -std=c++11 -Wl,--no-as-needed </p>

<h2>
<a id="osx-xcodegcc" class="anchor" href="#osx-xcodegcc" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>OSX (XCODE+GCC)</h2>

<p>The '-static' option is not available uinsg XCode/OSX, so the following compiler flags were used:</p>

<p>CPPFLAGS = -g -O3 </p>

<h2>
<a id="windows-mingw-w64" class="anchor" href="#windows-mingw-w64" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Windows: (mingw-w64)</h2>

<p>Compiler flags:</p>

<p>CPPFLAGS = -g -static -O3</p>

<p>MPS has been tested uing mingw in windows. Note that not all builds of mingw will work. Therefor we specifically make use of mingw-w64 ([<a href="http://mingw-w64.org/doku.php">http://mingw-w64.org/doku.php</a>]), which can be obtained in a number of ways.</p>

<p>One (recommended) approach is to make use of MSYS2. Follow the guide at [<a href="http://msys2.github.io/">http://msys2.github.io/</a>] to install MSYS2, and then install the mingw_w64 toolchain using:</p>

<pre><code>    pacman -S mingw-w64-x86_64-gcc
    pacman -S make
</code></pre>

<h1>
<a id="release-history" class="anchor" href="#release-history" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Release history</h1>

<h2>
<a id="v10-15-02-2016" class="anchor" href="#v10-15-02-2016" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>v1.0 [15-02-2016]</h2>

<p>Initial release of MPS, with
<code>mps_snesim_list</code>, 
<code>mps_snesim_tree</code>, and
<code>mps_genesim</code>.</p>

<h1>
<a id="running-mps-algorithms" class="anchor" href="#running-mps-algorithms" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Running MPS algorithms</h1>

<p>The MPS algorithms are run from the commandline using a parameter filename as an argument.
If no argument is give, the deafault parameter file is assumed to the be name of the simulation 
algorithm appended with '.txt'.</p>

<p>Therefore</p>

<pre><code>mps_genesim
</code></pre>

<p>and </p>

<pre><code>mps_genesim mps_genesim.txt 
</code></pre>

<p>has the same meaning.</p>

<h2>
<a id="snesim-mps_snesim_tree-and-mps_snesim_list" class="anchor" href="#snesim-mps_snesim_tree-and-mps_snesim_list" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>SNESIM: <code>mps_snesim_tree</code> and <code>mps_snesim_list</code>
</h2>

<p>the <code>mps_snesim_tree</code> and <code>mps_snesim_list</code> differ only in the way conditional data are stored in memory
(using either a tree or a list structure). </p>

<p>Both algorithms share the same format for the required parameter file:</p>

<pre><code>Number of realizations # 1
Random Seed (0 for not random seed) # 0
Number of mulitple grids # 2
Min Node count (0 if not set any limit) # 0
Max Conditional count (-1 if not using any limit) # -1
Search template size X # 5
Search template size Y # 5
Search template size Z # 1
Simulation grid size X # 100
Simulation grid size Y # 100
Simulation grid size Z # 1
Simulation grid world/origin X # 0
Simulation grid world/origin Y # 0
Simulation grid world/origin Z # 0
Simulation grid grid cell size X # 1
Simulation grid grid cell size Y # 1
Simulation grid grid cell size Z # 1
Training image file (spaces not allowed) # TI/mps_ti.dat
Output folder (spaces in name not allowed) # output/.
Shuffle Simulation Grid path (1 : random, 0 : sequential) # 1
Maximum number of counts for condtitional pdf # 10000
Shuffle Training Image path (1 : random, 0 : sequential) # 1
HardData filaneme  (same size as the simulation grid)# harddata/mps_hard_grid.dat
HardData seach radius (world units) # 15
Softdata categories (separated by ;) # 1;0
Soft datafilenames (separated by ; only need (number_categories - 1) grids) # softdata/mps_soft_xyzd_grid.dat
Number of threads (minimum 1, maximum 8 - depend on your CPU) # 1
Debug mode(2: write to file, 1: show preview, 0: show counters, -1: no ) # 1
</code></pre>

<p>A few lines in the paremeter files are specific to the SNESIM type algorithms, and will be discussed below:</p>

<h4>
<a id="line-3-n_mul_grids" class="anchor" href="#line-3-n_mul_grids" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>line 3, n_mul_grids</h4>

<p>n_mul_grids defines the number of multiple grids used. 
n_mul_grids=0, means that no multiple grid will be used.</p>

<h4>
<a id="line-4-n_min_node" class="anchor" href="#line-4-n_min_node" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>line 4, n_min_node</h4>

<p>The search tree will only be searched to a level where the number of counts in the 
conditional distribution is above n_min_node.</p>

<h4>
<a id="line-5-n_cond" class="anchor" href="#line-5-n_cond" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>line 5, n_cond</h4>

<p>n_cond is the maximum number of conditional point used, within the search template</p>

<h4>
<a id="lines-6-8-the-search-template-tem_nx-tem_ny-tem_nz" class="anchor" href="#lines-6-8-the-search-template-tem_nx-tem_ny-tem_nz" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>lines 6-8, the search template, tem_nx, tem_ny, tem_nz</h4>

<p>The search template defines the size of the template that is used to prescan the traning image 
and store (using a tree or list) the conditional distribution for all figurations of the data template. </p>

<h2>
<a id="generalized-enesim-mps_genesim" class="anchor" href="#generalized-enesim-mps_genesim" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Generalized ENESIM: mps_genesim</h2>

<p><code>mps_genesim</code> is a generalized version of the ENESIM algorithm, that can be used to perform MPS simulation 
similar to both ENESIM and Direct sampling (and in-between) depending how it is run.</p>

<p>An example of a parameter file is:</p>

<pre><code>Number of realizations # 1
Random Seed (0 `random` seed) # 0
Maximum number of counts for conditional pdf # 1
Max number of conditional point # 25
Max number of iterations # 10000
Simulation grid size X # 18
Simulation grid size Y # 16
Simulation grid size Z # 1
Simulation grid world/origin X # 0
Simulation grid world/origin Y # 0
Simulation grid world/origin Z # 0
Simulation grid grid cell size X # 1
Simulation grid grid cell size Y # 1
Simulation grid grid cell size Z # 1
Training image file (spaces not allowed) # ti.dat
Output folder (spaces in name not allowed) # .
Shuffle Simulation Grid path (1 : random, 0 : sequential) # 2
Shuffle Training Image path (1 : random, 0 : sequential) # 1
HardData filename  (same size as the simulation grid)# conditional.dat
HardData seach radius (world units) # 1
Softdata categories (separated by ;) # 0;1
Soft datafilenames (separated by ; only need (number_categories - 1) grids) # soft.dat
Number of threads (minimum 1, maximum 8 - depend on your CPU) # 1
Debug mode(2: write to file, 1: show preview, 0: show counters, -1: no ) # -2
</code></pre>

<p>A few lines in the parameter files are specific to the GENESIM type algorithm, and will be discussed below:</p>

<h4>
<a id="line-3-maximum-number-of-counts-for-conditional-pdf-n_max_count_cpdf" class="anchor" href="#line-3-maximum-number-of-counts-for-conditional-pdf-n_max_count_cpdf" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>line 3: Maximum number of counts for conditional pdf, n_max_count_cpdf</h4>

<p>n_max_count_cpdf defines the maximum number of counts in the conditional distribtion obtained from the training image.
When n_max_count_cpdf has been reached the scanning of the training image stops. </p>

<h5>
<a id="enesim-style" class="anchor" href="#enesim-style" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ENESIM style</h5>

<p>In case n_max_count_cpdf=infinity, mps_genesim will behave exactly to the classical ENESIM
algorithm, where the full traning is scanned at each iteration</p>

<h5>
<a id="direct-sampling-style" class="anchor" href="#direct-sampling-style" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Direct sampling style</h5>

<p>In case n_max_count_cpdf=1, mps_genesim will behave similar to the direct sampling algorithm, </p>

<h4>
<a id="line-4-max-number-for-conditional-points-n_cond" class="anchor" href="#line-4-max-number-for-conditional-points-n_cond" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>line 4: Max number for conditional points, n_cond</h4>

<p>A maximum of n_cond conditional data are considered at each iteration when infering the 
conditional pdf from the training image.</p>

<h4>
<a id="line-5max-number-of-iterations-n_max_ite" class="anchor" href="#line-5max-number-of-iterations-n_max_ite" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>line 5:Max number of iterations, n_max_ite</h4>

<p>A maximum of n_max_ite iterations of searching through the training image are performed. </p>

<h2>
<a id="general-options-in-the-parameter-files" class="anchor" href="#general-options-in-the-parameter-files" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>General options in the parameter files</h2>

<p>The following entrie appear in all parameter files</p>

<h4>
<a id="number-of-realizations" class="anchor" href="#number-of-realizations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Number of realizations</h4>

<p>The number of realizations to generate</p>

<h4>
<a id="random-seed" class="anchor" href="#random-seed" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Random Seed</h4>

<p>An integer determines the random seed. A fixed value will return the same realizations for each run.</p>

<ul>
<li>[0] assign a 'random' seed at each iteratoin (new seed every second)</li>
</ul>

<h4>
<a id="simulation-grid-size-x-y-z" class="anchor" href="#simulation-grid-size-x-y-z" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Simulation grid size X, Y, Z</h4>

<p>The number of grid cells in the simulation grid </p>

<h4>
<a id="simulation-grid-origin-x-y-z" class="anchor" href="#simulation-grid-origin-x-y-z" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Simulation grid origin X, Y, Z</h4>

<p>The value coordinate of the first pixel in the X, Y, and Z direction. </p>

<h4>
<a id="simulation-grid-grid-cell-size-x-" class="anchor" href="#simulation-grid-grid-cell-size-x-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Simulation grid grid cell size X #</h4>

<p>The size of each pixel in the simulation grid, in the X, Y, and Z direction. </p>

<h4>
<a id="training-image-file" class="anchor" href="#training-image-file" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Training image file</h4>

<p>The name of the training image file (no spaces allowed).
it must be in GLSIB/EAS ASCII format, and the first line (the 'title') must contain the 
dimension of the traning file as 'NXxNYxNZ'.
See the TI folder for examples. </p>

<h4>
<a id="output-folder-spaces-in-name-not-allowed" class="anchor" href="#output-folder-spaces-in-name-not-allowed" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Output folder (spaces in name not allowed)</h4>

<p>The path to the folder containing all output. Use forward slash '/' to separate folders.</p>

<h4>
<a id="shuffle-simulation-grid-path-1--random-0--sequential--1" class="anchor" href="#shuffle-simulation-grid-path-1--random-0--sequential--1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Shuffle Simulation Grid path (1 : random, 0 : sequential) # 1</h4>

<ul>
<li>[0] sequential path through simulation grid (possibly a multiple grid)</li>
<li>[1] random path through simulation grid</li>
</ul>

<h4>
<a id="maximum-number-of-counts-for-condtitional-pdf" class="anchor" href="#maximum-number-of-counts-for-condtitional-pdf" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Maximum number of counts for condtitional pdf</h4>

<h4>
<a id="shuffle-training-image-path-1--random-0--sequential" class="anchor" href="#shuffle-training-image-path-1--random-0--sequential" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Shuffle Training Image path (1 : random, 0 : sequential)</h4>

<p>(Does not affect snesim type algrothms)</p>

<ul>
<li>[0] sequential path </li>
<li>[1] random path</li>
</ul>

<h4>
<a id="harddata-filaneme" class="anchor" href="#harddata-filaneme" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>HardData filaneme</h4>

<p>EAS filename wity 4 columns: X, Y, Z, and D</p>

<h4>
<a id="harddata-seach-radius" class="anchor" href="#harddata-seach-radius" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>HardData seach radius</h4>

<p>(world units) </p>

<h4>
<a id="softdata-categories" class="anchor" href="#softdata-categories" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Softdata categories</h4>

<p>(separated by ;) </p>

<h4>
<a id="soft-datafilenames" class="anchor" href="#soft-datafilenames" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Soft datafilenames</h4>

<p>(separated by ; only need (number_categories - 1) grids) </p>

<h4>
<a id="number-of-threads-minimum-1-maximum-8---depend-on-your-cpu" class="anchor" href="#number-of-threads-minimum-1-maximum-8---depend-on-your-cpu" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Number of threads (minimum 1, maximum 8 - depend on your CPU)</h4>

<p>Currently not used. </p>

<h4>
<a id="debug-mode" class="anchor" href="#debug-mode" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Debug mode</h4>

<ul>
<li>[-2]: No information is written to screen or files on disk</li>
<li>[-1]: + Simulation output is written to files on disk</li>
<li>[ 0]: + Information about simulation is written to screen</li>
<li>[ 1]: + Simulated realization(s) are shown in terminal</li>
<li>[ 2]: + Extra information is written to disk (Random path, ...)</li>
<li>[ 3]: + Debug information written to screen (in general not useful for an end-user)</li>
</ul>
      </section>
    </div>

    
  </body>
</html>
